<html>
<head>
	<meta charset="UTF-8">
	<meta name="description" content="An app for producing linguistics syntax trees from labelled bracket notation." />
	<title>Syntax Tree Generator</title>
	<link type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet" />	
	<link type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />	
	<style type="text/css">
		#title {
			/* Hide the word "Generator" when too narrow to fit on one line*/
			overflow: hidden;
			height: 1.3em; /* Slightly more than line-height to avoid clipping the tail of y*/
		}
		.gutter { 
			background-color: #fcfcfc;
			background-repeat: no-repeat; 
			background-position: 50%;
			border: 1px solid #dee2e6;
			border-radius: .25rem;
		}
		.gutter.gutter-horizontal { 
			cursor: col-resize;
			/* https://stackoverflow.com/questions/49370421/making-columns-resizable-in-bootstrap-4 */
			background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==');
		}
		#image-goes-here img { max-width: 100%; }
	</style>
</head>
<body>
	<div class="container-fluid">
		<div class="row mt-2">
			<div id="left-col" class="col" style="flex-basis: calc(40% - 5px);"><!-- Render at correct width before split.js loads -->
				<h1 id="title">Syntax Tree Generator</h1>
				<div class="form-group mb-1">
					<textarea id="i" rows="8" class="form-control">[S [NP This] [VP [V is] [^NP a wug]]]</textarea>
				</div>
				Insert symbol:
				<input type="button" class="btn btn-sm btn-outline-primary insertSymbol" value="Ø" title="Silent head" data-toggle="tooltip">
				<input type="button" class="btn btn-sm btn-outline-primary insertSymbol" value="［" title="Literal left bracket (used with tense)" data-toggle="tooltip">
				<input type="button" class="btn btn-sm btn-outline-primary insertSymbol" value="］" title="Literal right bracket (used with tense)" data-toggle="tooltip">
				
				<h3>Options</h3><div>
					<table>
						<tr>
							<td colspan="2" align="center"><div id="font-style-radio" class="btn-group btn-group-toggle" data-toggle="buttons">
								<label for="serif" class="btn btn-outline-primary"><input type="radio" name="font-style" id="serif" value="serif" class="redraw" />Serif</label>
								<label for="sans-serif" class="btn btn-outline-primary active"><input type="radio" name="font-style" id="sans-serif" value="sans-serif" class="redraw" checked />Sans-Serif</label>
								<label for="monospace" class="btn btn-outline-primary"><input type="radio" name="font-style" id="monospace" value="monospace" class="redraw" />Monospace</label>
							</div></td>
						</tr>
						<tr>
							<td align="center">Terminals:</td>
							<td align="center">Non-terminals:</td>
						</tr>
						<tr>
							<td align="center"><div id="term-font-check" class="btn-group-toggle" data-toggle="buttons">
								<label for="term-bold" class="btn btn-outline-primary"><input type="checkbox" id="term-bold" class="redraw" />Bold</label>
								<label for="term-ital" class="btn btn-outline-primary"><input type="checkbox" id="term-ital" class="redraw" />Italic</label>
							</span></td>
							<td align="center"><div id="nonterm-font-check" class="btn-group-toggle" data-toggle="buttons">
								<label for="nonterm-bold" class="btn btn-outline-primary"><input type="checkbox" id="nonterm-bold" class="redraw" />Bold</label>
								<label for="nonterm-ital" class="btn btn-outline-primary"><input type="checkbox" id="nonterm-ital" class="redraw" />Italic</label>
							</span></td>
						</tr>
						<tr>
							<td align="left">Resolution <abbr title="Higher values produce a better looking image, but lowering this while editing can improve performance." data-toggle="tooltip" data-placement="right">(?)</abbr>:</td>
							<td><input type="range" id="resolution-slider" class="redraw" value="3" min="1" max="5" step=".5"></td>
						</tr>
						<tr>
							<td align="left">Font size:</td>
							<td><input type="range" id="font-size-slider" class="redraw" value="12" min="8" max="16" step="1"></td>
						</tr>
						<tr>
							<td align="left">Height:</td>
							<td><input type="range" id="vert-space-slider" class="redraw" value="35" min="35" max="70" step="5"></td>
						</tr>
						<tr>
							<td align="left">Width:</td>
							<td><input type="range" id="hor-space-slider" class="redraw" value="10" min="10" max="50" step="5"></td>
						</tr>
						<tr>
							<td align="center" colspan="2"><div class="btn-group-toggle" data-toggle="buttons">
								<label for="color-check" class="btn btn-outline-primary active"><input type="checkbox" id="color-check" class="redraw" checked />Color</label>
								<label for="term-lines" class="btn btn-outline-primary active"><input type="checkbox" id="term-lines" class="redraw" checked />Terminal lines</label>
							</div></td>
						</tr>
					</table>
				</div>
			</div>
			<div id="right-col" class="col text-center" style="flex-basis: calc(60% + 5px);">
				<div id="image-goes-here" class="card d-inline-block mw-100" style="overflow: hidden"></div>
			</div>
		</div>
		<div class="row">
			<div class="col-12">
				<h3>Help</h3>
				<p>Use labelled bracket notation. This app will build the tree as you type and will attempt to close any brackets that you may be missing. Save the image to your computer by right-clicking on it and selecting "Save image as". For more information, including on how to draw movement lines, visit the <a href="https://github.com/mshang/syntree/wiki">wiki</a>.</p>
				<p>The URL of this page automatically updates to include your tree for easy sharing.</p>
				<h3>Examples</h3>
				<a class="example" href="?ex1#[NP^ Alice]">[NP^ Alice]</a><br />
				<a class="example" href="?ex2#[NP [N Alice] and [N Bob]]">[NP [N Alice] and [N Bob]]</a><br />
				<a class="example" href="?ex3#[S[NP[N Alice]][VP[V is][NP[N'[N a student][PP^ of physics">[S[NP[N Alice]][VP[V is][NP[N'[N a student][PP^ of physics</a><br />
				<a class="example" href="?ex4#[S [X_a Movement] [Y example &lt;a&gt;]]">[S [X_a Movement] [Y example &lt;a&gt;]]</a><br />
				<a class="example" href="?ex5#[CP [NP^_1 What] [C' [C_b did] [IP_2 [NP^ you] [I' [I tr&lt;b&gt;] [VP [V' [V eat] tr&lt;1&gt;]]]]]]">[CP [NP^_1 What] [C' [C_b did] [IP_2 [NP^ you] [I' [I tr&lt;b&gt;] [VP [V' [V eat] tr&lt;1&gt;]]]]]]</a><br />
				<a class="example" href="?ex6#[A [A [A [A A] [A_2 A] [A [A A]]] [A_0 A]] [A [A [A [A [A A<0>] A<1>] A<2>] [A [A_1 A<3>] [A A] [A_3 A]]] A<0>">Movement 2</a><br />
				<a class="example" href="?ex7#[A [A [A_0 [A A] [A A] [A [A A]]] [A A]] [A [A [A [A [A A] A] A<0>] [A [A A] [A A] [A A]]] A">Movement 3</a>
			</div>
		</div>
		<footer class="row pt-2 my-2 border-top">
			<div class="col-12 text-center">
				<a href="https://github.com/mshang/syntree">Original GitHub repo</a> &copy; 2011 by <a href="http://mshang.ca/">Miles Shang</a> |
				<a href="https://github.com/dprebyl/syntree">Forked GitHub repo</a> &copy; 2020 by Drake Prebyl |
				<a href="LICENSE.txt">License</a>
			</div>
		</footer>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.0/split.min.js"></script>
	<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
	<script type="text/javascript" src="js/base64.js"></script>
	<script type="text/javascript" src="js/canvas2image.js"></script>
	<script type="text/javascript" src="js/syntree.js"></script>
	<script type="text/javascript">
		function handler() {
		try {
			// Initialize the various options.
			var term_font = "";
			var nonterm_font = "";
			var color = false;
			var term_lines = false;
			if (document.getElementById("term-ital").checked) term_font += "italic ";
			if (document.getElementById("term-bold").checked) term_font += "bold ";
			if (document.getElementById("nonterm-ital").checked) nonterm_font += "italic ";
			if (document.getElementById("nonterm-bold").checked) nonterm_font += "bold ";
			if (document.getElementById("color-check").checked) color = true;
			if (document.getElementById("term-lines").checked) term_lines = true;
			resolution = document.getElementById("resolution-slider").value;
			font_size = document.getElementById("font-size-slider").value;
			vert_space = document.getElementById("vert-space-slider").value;
			hor_space = document.getElementById("hor-space-slider").value;
			term_font += "<size>pt "; // Size will be inserted here in go
			nonterm_font += "<size>pt ";
			term_font = term_font + $('input:radio[name=font-style]:checked').val();
			nonterm_font = nonterm_font + $('input:radio[name=font-style]:checked').val();
			
			// Get the string.
			var str = document.getElementById("i").value;
			window.location.hash = str;
			
			/*$("#image-goes-here").text(str + ", " + font_size + ", " + 
				term_font + ", " + nonterm_font + ", " + vert_space + ", " + hor_space);*/
			
			var img = go(str, resolution, font_size, term_font, nonterm_font, vert_space, hor_space, color, term_lines);
			$("#image-goes-here").empty();
			$("#image-goes-here").append(img);
			
		} catch (err) {
			if (debug) throw(err);
		} // try-catch
		return false;
		} // handler()

		$(function() {			
			Split(["#left-col", "#right-col"], {
				// https://stackoverflow.com/questions/49370421/making-columns-resizable-in-bootstrap-4
				elementStyle: function (dimension, size, gutterSize) {
					return {'flex-basis': 'calc(' + size + '% - ' + gutterSize + 'px)'}
				},
				sizes: [40, 60],
				minSize: [300, 150],
			});
			
			$(function () {
			  $('[data-toggle="tooltip"]').tooltip()
			});
			
			try {
				var qs = decodeURIComponent(window.location.hash.slice(1));
				qs = qs.replace(/^i=/,"");
				qs = qs.replace(/\+/g," ");
				if (qs == "") throw "";
				document.getElementById("i").value = qs;
			} catch (err) {}
			
			handler();
			
			// Events
			$("#i").keypress(function() {handler(); return true;});
			$("#i").keyup(function() {handler(); return true;});
			$("#i").keydown(function() {handler(); return true;});
			$("#i").change(function() {handler(); return true;});
			$(".redraw:not(input[type=range])").change(function() {return handler()});
			$("input[type=range].redraw").on("input", function() {return handler()});
			
			$(".example").click(function(e) {
				var link = e.target.href;
				var qs = decodeURIComponent(link.substring(link.indexOf("#")+1));
				document.getElementById("i").value = qs;
				handler();
				return false;
			});
			
			$(".insertSymbol").click(function(e) {
				console.log("hi");
				var textarea = document.getElementById("i");
				textarea.value += e.target.value;
				textarea.focus();
			});
		});
	</script>
</body>
</html>